# 9.4. Iteración 3: Refinar estructuras para abordar el atributo de calidad más importante

---

## Paso 1: Revisar Entradas

| **Propósito de Diseño**                              | **Funcionalidad Primaria**                                                        | **Escenarios de Calidad**                        | **Restricciones y Preocupaciones de Arquitectura**               |
|------------------------------------------------------|-----------------------------------------------------------------------------------|-------------------------------------------------|-------------------------------------------------------------------|
| Refinar las estructuras existentes para optimizar el rendimiento, escalabilidad y seguridad del sistema. | UC-01, UC-02, UC-10, UC-11, UC-18, UC-19, UC-22, UC-30, UC-31                     | QA-02, QA-04, QA-05, QA-06, QA-07                               | CON-01, CON-03, CON-05                                          |

En iteraciones previas:
- Se definió una arquitectura modular basada en un monolito.
- Se eligieron PostgreSQL y MongoDB para gestionar datos estructurados y no estructurados.
- Se implementó autenticación con JWT y notificaciones con Firebase Cloud Messaging.
- Aún no se aborda completamente el rendimiento bajo carga y la capacidad de escalar.

---

## Paso 2: Establecer objetivo de la iteración

El objetivo es refinar la arquitectura para abordar **escalabilidad** (QA-05) como el atributo de calidad más importante, optimizando la gestión de carga y asegurando un rendimiento adecuado para soportar crecimiento en usuarios y datos.

---

## Paso 3: Elección de elementos del sistema a refinar


## Paso 4: Elección de conceptos de diseño que satisfacen el driver seleccionado

| **Código** | **Decisión de Diseño**                                                              | **Fundamentación**                                                                                                                                                               |
|------------|--------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **DEC-18** | Implementar caching para consultas frecuentes usando Redis.                         | Mejora el rendimiento reduciendo la carga sobre las bases de datos relacionales y no relacionales (QA-07, QA-05).                                                             |
| **DEC-19** | Desplegar balanceadores de carga para gestionar solicitudes concurrentes.            | Garantiza alta disponibilidad y distribución uniforme de la carga entre instancias del monolito (QA-05).                                                                      |
| **DEC-20** | Optimizar índices y particionar tablas en PostgreSQL.                               | Mejora el rendimiento de consultas y la escalabilidad de datos transaccionales, alineándose con las restricciones (QA-04, QA-05).                                             |
| **DEC-21** | Escalabilidad horizontal para MongoDB con configuración de clústeres.               | Soporta la gestión eficiente de datos dinámicos y no estructurados a medida que el volumen aumenta (QA-05).                                                                  |
| **DEC-22** | Refinar APIs internas utilizando GraphQL.                                           | Reduce la cantidad de datos transferidos y mejora la eficiencia de comunicación entre módulos (QA-07).                                                                        |
| **DEC-23** | Incorporar ElasticSearch para búsquedas rápidas en datos no estructurados del foro. | Mejora el rendimiento en operaciones de búsqueda complejas, como publicaciones y comentarios en el foro (QA-07).                                                             |

---

## Paso 5: Instanciar elementos de arquitectura, asignar responsabilidades y definir interfaces

| **Código** | **Elemento de Arquitectura**    | **Responsabilidad**                                                                | **Interfaces Asociadas**                         |
|------------|----------------------------------|------------------------------------------------------------------------------------|-------------------------------------------------|
| **DEC-24** | Redis                            | Gestionar el caching de datos temporales y solicitudes frecuentes.                 | APIs internas para autenticación y notificaciones. |
| **DEC-25** | APIs internas con GraphQL        | Optimizar la comunicación entre módulos con consultas más precisas y eficientes.   | Endpoints expuestos para módulos de login, foro y estadísticas. |
| **DEC-26** | PostgreSQL particionado          | Manejar datos estructurados con alta concurrencia y volumen histórico.             | Conexión directa desde módulos transaccionales (login, estadísticas). |
| **DEC-27** | MongoDB con configuración de shards | Soportar escalabilidad horizontal para datos dinámicos del foro y logs.           | Módulo del foro y sistema de notificaciones.    |
| **DEC-28** | ElasticSearch                    | Mejorar la búsqueda y filtrado en datos no estructurados del foro.                 | Módulo del foro y APIs de consulta para usuarios. |

---

## Paso 6: Bosquejar vistas y registrar decisiones de diseño

### Diagrama de arquitectura refinada





## Paso 7: Analizar el diseño actual, revisar objetivo de la iteración y logro del propósito de diseño

| **No abordado** | **Parcialmente abordado** | **Completamente abordado** | **Decisión de diseño**          |
|-----------------|---------------------------|----------------------------|----------------------------------|
|                 |                           | QA-05                      | DEC-18, DEC-19, DEC-20, DEC-21  |
|                 |                           | QA-07                      | DEC-22, DEC-23, DEC-24, DEC-28  |
|                 | QA-02                     |                            | DEC-19                          |
|                 |                           | QA-04                      | DEC-20, DEC-26                  |
|                 |                           | UC-01                      | DEC-19, DEC-24                  |
|                 |                           | UC-10                      | DEC-21, DEC-28                  |
|                 |                           | UC-18                      | DEC-24, DEC-27                  |
|                 |                           | UC-30                      | DEC-23, DEC-28                  |

Con estas mejoras, el diseño aborda directamente la necesidad de escalar el sistema mientras optimiza el rendimiento y mantiene la seguridad.
